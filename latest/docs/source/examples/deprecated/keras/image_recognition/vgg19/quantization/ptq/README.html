

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../../../../../../../../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Step-by-Step (Deprecated) &mdash; Intel® Neural Compressor 3.7.1 documentation</title>
      <link rel="stylesheet" type="text/css" href="../../../../../../../../../_static/pygments.css?v=03e43079" />
      <link rel="stylesheet" type="text/css" href="../../../../../../../../../_static/css/theme.css?v=e59714d7" />
      <link rel="stylesheet" type="text/css" href="../../../../../../../../../_static/graphviz.css?v=4ae1632d" />
      <link rel="stylesheet" type="text/css" href="../../../../../../../../../_static/custom.css?v=68dfede1" />

  
<script type="text/javascript">
  // Configure TMS settings
  window.wapProfile = 'profile-microsite'; // This is mapped by WAP authorize value
  window.wapLocalCode = 'us-en'; // Dynamically set per localized site, see mapping table for values
  window.wapSection = "neural-compressor"; // WAP team will give you a unique section for your site
  window.wapEnv = 'prod'; // environment to be use in Adobe Tags.
  // Load TMS
  (() => {
        let url = 'https://www.intel.com/content/dam/www/global/wap/main/wap-microsite.js';
        let po = document.createElement('script'); po.type = 'text/javascript'; po.async = true; po.src = url;
        let s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(po, s);
  }) ();
</script>

    <link rel="index" title="Index" href="../../../../../../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../../../../../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../../../../../../../../index.html" class="icon icon-home">
            Intel® Neural Compressor
          </a>
            <div class="version">
              <a href="../../../../../../../../../../versions.html">latest▼</a>
              <p>Click link above to switch version</p>
            </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../../../../../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../../../../get_started.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../../../installation_guide.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../../../examples_readme.html">Examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../../../api-doc/apis.html">APIs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../../../legal_information.html">Legal Information</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../../../SECURITY.html">Security Policy</a></li>
<li class="toctree-l1"><a class="reference external" href="https://github.com/intel/neural-compressor">Repo</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../../../../../../../index.html">Intel® Neural Compressor</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../../../../../../../index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">Step-by-Step (Deprecated)</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../../../../../../../../_sources/docs/source/examples/deprecated/keras/image_recognition/vgg19/quantization/ptq/README.md.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="step-by-step-deprecated">
<h1>Step-by-Step (Deprecated)<a class="headerlink" href="#step-by-step-deprecated" title="Link to this heading"></a></h1>
<p>This document is used to enable Tensorflow Keras model VGG19 quantization and benchmark using Intel® Neural Compressor.
This example can run on Intel CPUs and GPUs.</p>
</section>
<section id="prerequisite">
<h1>Prerequisite<a class="headerlink" href="#prerequisite" title="Link to this heading"></a></h1>
<section id="environment">
<h2>1. Environment<a class="headerlink" href="#environment" title="Link to this heading"></a></h2>
<section id="installation">
<h3>Installation<a class="headerlink" href="#installation" title="Link to this heading"></a></h3>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span><span class="c1"># Install Intel® Neural Compressor</span>
pip<span class="w"> </span>install<span class="w"> </span>neural-compressor
</pre></div>
</div>
</section>
<section id="install-requirements">
<h3>Install Requirements<a class="headerlink" href="#install-requirements" title="Link to this heading"></a></h3>
<p>The Tensorflow and intel-extension-for-tensorflow is mandatory to be installed to run this example.
The Intel Extension for Tensorflow for Intel CPUs is installed as default.</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>pip<span class="w"> </span>install<span class="w"> </span>-r<span class="w"> </span>requirements.txt
</pre></div>
</div>
<blockquote>
<div><p>Note: Validated TensorFlow <a class="reference external" href="/docs/source/installation_guide.html#validated-software-environment">Version</a>.</p>
</div></blockquote>
</section>
</section>
<section id="prepare-pretrained-model">
<h2>2. Prepare Pretrained model<a class="headerlink" href="#prepare-pretrained-model" title="Link to this heading"></a></h2>
<p>The pretrained model is provided by <a class="reference external" href="https://keras.io/api/applications/">Keras Applications</a>. prepare the model, Run as follow:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">python</span> <span class="n">prepare_model</span><span class="o">.</span><span class="n">py</span> <span class="o">--</span><span class="n">output_model</span><span class="o">=/</span><span class="n">path</span><span class="o">/</span><span class="n">to</span><span class="o">/</span><span class="n">model</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">--output_model</span> </code> the model should be saved as SavedModel format or H5 format.</p>
<section id="prepare-dataset">
<h3>3. Prepare Dataset<a class="headerlink" href="#prepare-dataset" title="Link to this heading"></a></h3>
<p>TensorFlow <a class="reference external" href="https://github.com/tensorflow/models">models</a> repo provides <a class="reference external" href="https://github.com/tensorflow/models/tree/master/research/slim#an-automated-script-for-processing-imagenet-data">scripts and instructions</a> to download, process and convert the ImageNet dataset to the TF records format.
We also prepared related scripts in <code class="docutils literal notranslate"><span class="pre">imagenet_prepare</span></code> directory. To download the raw images, the user must create an account with image-net.org. If you have downloaded the raw data and preprocessed the validation data by moving the images into the appropriate sub-directory based on the label (synset) of the image. we can use below command ro convert it to tf records format.</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span><span class="nb">cd</span><span class="w"> </span>examples/keras/image_recognition/
<span class="c1"># convert validation subset</span>
bash<span class="w"> </span>prepare_dataset.sh<span class="w"> </span>--output_dir<span class="o">=</span>./vgg19/quantization/ptq/data<span class="w"> </span>--raw_dir<span class="o">=</span>/PATH/TO/img_raw/val/<span class="w"> </span>--subset<span class="o">=</span>validation
<span class="c1"># convert train subset</span>
bash<span class="w"> </span>prepare_dataset.sh<span class="w"> </span>--output_dir<span class="o">=</span>./vgg19/quantization/ptq/data<span class="w"> </span>--raw_dir<span class="o">=</span>/PATH/TO/img_raw/train/<span class="w"> </span>--subset<span class="o">=</span>train
<span class="nb">cd</span><span class="w"> </span>vgg19/quantization/ptq
</pre></div>
</div>
<blockquote>
<div><p><strong>Note</strong>:
The raw ImageNet dataset resides in JPEG files should be in the following directory structure. Taking validation set as an example:<br>
        /PATH/TO/img_raw/val/n01440764/ILSVRC2012_val_00000293.JPEG<br>
        /PATH/TO/img_raw/val/n01440764/ILSVRC2012_val_00000543.JPEG<br>
where ‘n01440764’ is the unique synset label associated with these images.</p>
</div></blockquote>
</section>
</section>
</section>
<section id="run-command">
<h1>Run Command<a class="headerlink" href="#run-command" title="Link to this heading"></a></h1>
<section id="quantization-config">
<h2>Quantization Config<a class="headerlink" href="#quantization-config" title="Link to this heading"></a></h2>
<p>The Quantization Config class has default parameters setting for running on Intel CPUs. If running this example on Intel GPUs, the ‘backend’ parameter should be set to ‘itex’ and the ‘device’ parameter should be set to ‘gpu’.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">config</span> <span class="o">=</span> <span class="n">PostTrainingQuantConfig</span><span class="p">(</span>
    <span class="n">device</span><span class="o">=</span><span class="s2">&quot;gpu&quot;</span><span class="p">,</span>
    <span class="n">backend</span><span class="o">=</span><span class="s2">&quot;itex&quot;</span><span class="p">,</span>
    <span class="o">...</span>
    <span class="p">)</span>
</pre></div>
</div>
</section>
<section id="quantization">
<h2>Quantization<a class="headerlink" href="#quantization" title="Link to this heading"></a></h2>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>bash<span class="w"> </span>run_quant.sh<span class="w"> </span>--input_model<span class="o">=</span>./vgg19_keras/<span class="w"> </span>--output_model<span class="o">=</span>./result<span class="w"> </span>--dataset_location<span class="o">=</span>/path/to/evaluation/dataset
</pre></div>
</div>
</section>
<section id="benchmark">
<h2>Benchmark<a class="headerlink" href="#benchmark" title="Link to this heading"></a></h2>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>bash<span class="w"> </span>run_benchmark.sh<span class="w"> </span>--input_model<span class="o">=</span>./result<span class="w"> </span>--mode<span class="o">=</span>accuracy<span class="w"> </span>--dataset_location<span class="o">=</span>/path/to/evaluation/dataset<span class="w"> </span>--batch_size<span class="o">=</span><span class="m">32</span>
bash<span class="w"> </span>run_benchmark.sh<span class="w"> </span>--input_model<span class="o">=</span>./result<span class="w"> </span>--mode<span class="o">=</span>performance<span class="w"> </span>--dataset_location<span class="o">=</span>/path/to/evaluation/dataset<span class="w"> </span>--batch_size<span class="o">=</span><span class="m">1</span>
</pre></div>
</div>
</section>
</section>


           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2022, Intel® Neural Compressor, Intel.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   <jinja2.runtime.BlockReference object at 0x7f3baedaa840> 
  <p></p><div><a href='https://www.intel.com/content/www/us/en/privacy/intel-cookie-notice.html' data-cookie-notice='true'>Cookies</a> <a href='https://www.intel.com/content/www/us/en/privacy/intel-privacy-notice.html'>| Privacy</a></div>


</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>